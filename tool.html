<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Needs Reflection Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.1.2/src/wordcloud2.min.js"></script>
  <style>
    /* [Your full CSS from canvas here] */
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Needs Reflection Tool</h1>
      <p>Write a short reflection about your experience today:</p>
      <textarea id="reflectionInput" placeholder="Today I felt..."></textarea>
      <h2 class="section-title">What needs were present or unmet?</h2>
      <div id="needsChecklist"></div>
      <button onclick="saveReflection()">Submit Reflection</button>
    </div>

    <div class="card">
      <h2 class="section-title">Date Filters</h2>
      <div id="filters">
        <button onclick="filterByDays(7)">Last 7 Days</button>
        <button onclick="filterByDays(30)">Last 30 Days</button>
        <button onclick="filterByDays(9999)">All</button>
      </div>
    </div>

    <div class="card">
      <h2 class="section-title">Needs Word Cloud (Live Summary)</h2>
      <div id="wordCloud">No data yet.</div>
    </div>

    <div class="card">
      <h2 class="section-title">Your Past Reflections</h2>
      <table id="reflectionHistoryTable">
        <thead>
          <tr><th>Date</th><th>Reflection</th><th>Needs</th></tr>
        </thead>
        <tbody id="reflectionHistoryBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const allNeeds = [
      "Acceptance", "Affection", "Appreciation", "Authenticity", "Autonomy", "Balance",
      "Belonging", "Care", "Clarity", "Comfort", "Compassion", "Connection", "Consistency",
      "Contribution", "Creativity", "Dignity", "Ease", "Empathy", "Equality", "Faith",
      "Freedom", "Fun", "Gratitude", "Growth", "Harmony", "Hope", "Humor", "Inclusion",
      "Inspiration", "Integrity", "Joy", "Love", "Meaning", "Nourishment", "Order",
      "Peace", "Play", "Presence", "Purpose", "Recognition", "Respect", "Safety",
      "Security", "Self-Expression", "Stability", "Support", "Tenderness", "Trust",
      "Understanding", "Validation", "Warmth"
    ];

    const checklistDiv = document.getElementById("needsChecklist");
    const wordCloudDiv = document.getElementById("wordCloud");
    const tableBody = document.getElementById("reflectionHistoryBody");

    allNeeds.forEach(need => {
      const label = document.createElement("label");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.value = need;
      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(need));
      checklistDiv.appendChild(label);
    });

    function getStoredData() {
      return JSON.parse(localStorage.getItem("reflections") || "[]");
    }

    function saveReflection() {
      const text = document.getElementById("reflectionInput").value.trim();
      if (!text) return alert("Please write a reflection first.");

      const selected = [...document.querySelectorAll("#needsChecklist input:checked")].map(n => n.value);
      if (!selected.length) return alert("Please select at least one need.");

      const entry = {
        date: new Date().toISOString(),
        text,
        needs: selected
      };
      const all = getStoredData();
      all.unshift(entry);
      localStorage.setItem("reflections", JSON.stringify(all));
      document.getElementById("reflectionInput").value = "";
      document.querySelectorAll("#needsChecklist input").forEach(i => i.checked = false);
      renderHistory();
    }

    function filterByDays(days) {
      const cutoff = new Date();
      cutoff.setDate(cutoff.getDate() - days);
      renderHistory(cutoff);
    }

    function renderHistory(filterDate = null) {
      const data = getStoredData();
      tableBody.innerHTML = "";
      const allWords = {};
      data.forEach(entry => {
        const date = new Date(entry.date);
        if (filterDate && date < filterDate) return;
        const row = document.createElement("tr");
        row.innerHTML = `<td>${date.toLocaleDateString()}</td><td>${entry.text}</td><td>${entry.needs.join(", ")}</td>`;
        tableBody.appendChild(row);
        entry.needs.forEach(n => allWords[n] = (allWords[n] || 0) + 1);
      });

      if (Object.keys(allWords).length) {
        WordCloud(wordCloudDiv, {
          list: Object.entries(allWords),
          gridSize: 10,
          weightFactor: 6,
          color: () => '#' + Math.floor(Math.random()*16777215).toString(16),
          backgroundColor: "#f7fafc",
        });
      } else {
        wordCloudDiv.innerHTML = "No data yet.";
      }
    }

    renderHistory();
  </script>
</body>
</html>


